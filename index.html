<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>任务发布3.0-仅供学习交流 请勿商业用途</title>
    <style>
		/* 设置说明区域的样式 */
		.description {
		    background-color: #fff; /* 背景色为白色 */
		    color: #333; /* 字体颜色 */
		    border: 1px solid #ddd; /* 边框颜色 */
		    padding: 15px; /* 内边距 */
		    margin: 10px auto; /* 外边距居中 */
		    width: 93%; /* 宽度为100% */
		    max-width: 900px; /* 最大宽度为900px */
		    border-radius: 15px; /* 边角圆润 */
		    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* 设置阴影效果 */
		    text-align: left; /* 文字左对齐 */
		    transition: transform 0.3s ease-in-out; /* 添加过渡效果 */
		}
		
		/* 保证container区域居中 */
		.container {
		    width: 100%;
		    max-width: 900px;  /* 宽度限制 */
		    margin: 0 auto; /* 水平居中 */
		    padding: 30px;
		    border: 1px solid #ccc;
		    border-radius: 12px;
		    background-color: #ffffff; /* 背景色 */
		    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* 阴影效果 */
		}
		
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            font-size: 14px;
            color: #555;
			background-color: #f4f7fa; /* 背景颜色 */
        }
        .container {
            width: 100%;
            max-width: 900px;  /* 宽度限制 */
            margin: 0 auto;
            padding: 30px;
            border: 1px solid #ccc;
            border-radius: 12px;
            background-color: #ffffff; /* 背景色 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* 阴影效果 */
        }
        h1 {
            text-align: center;
            font-size: 26px; /* 增加字体大小 */
            margin-bottom: 20px;
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
            color: #333;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px; /* 增加内边距 */
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 8px; /* 圆角边框 */
            font-size: 14px;
            transition: border-color 0.3s;
        }
		.form-group input:focus, .form-group textarea:focus, .form-group select:focus {
		    border-color: #4CAF50; /* 聚焦时边框变为绿色 */
		}
        .submit-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px; /* 圆角 */
            font-size: 18px; /* 更大字体 */
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #45a049;
        }
        .add-remove-btn {
            display: inline-block;
            padding: 12px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 8px;
            margin-top: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .add-remove-btn:hover {
            background-color: #0056b3;
        }
        .image-preview {
            max-width: 300px;
            max-height: 300px;
            margin-top: 10px;
            border-radius: 8px; /* 预览图圆角 */
        }
		hr {
		    border: 1px solid #ccc;
		    margin: 40px 0;
		}
		/* 响应式设计 */
		@media (max-width: 600px) {
		    .container {
		        padding: 20px;
		        width: 90%;
		    }
		    h1 {
		        font-size: 22px;
		    }
		    .form-group input, .form-group textarea, .form-group select {
		        padding: 10px;
		    }
		    .submit-btn {
		        font-size: 16px;
		        padding: 12px;
		    }
		    .add-remove-btn {
		        padding: 10px 18px;
		        font-size: 14px;
		    }
		}
		
		span {
			color: #007BFF;
			font-weight: bold;
		
			
		}
    </style>
</head>
<body>
	<!-- 说明区域 -->
	<div class="description">
	    <h3>使用须知：</h3>
	    <ol>
	    <li>网页程序仅供学习交流，请勿用于商业，请勿传播;</li>
	    <li>当网页出现bug或在微信里打不开时请根据页面提示请尝试多刷新几次，或复制链接到浏览器打开;</li>
	    <li>多个链接需要操作时请点击增加发布任务;</li>
	    <li>任务填写完成后，点击页面最下方发布任务，此时会自动弹出提示下载一个后缀为html的文件，下载成功后用浏览器打开即可;</li>
		<li><span>鼠标光标在的输入框里时不要滚动鼠标滚轮，如要翻页请将鼠标光标移到输入框以外的地方翻页，否者会出现数值变化情况;</span></li>
	    <li>当发现问题输入框数量不对的时，请检查“发布几单”框数值是否正确;</li>
	    </ol>
	</div>

    <div class="container">
        <h1>任务发布</h1>
        <div id="publish-areas-container">
            <div class="publish-area" id="publish-area-1">
                <form id="task-form-1" action="#" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="release-date">发布日期：</label>
                        <input type="date" id="release-date-1" name="release-date" required>
                    </div>

                    <div class="form-group">
                        <label for="store-name">店铺名称：</label>
                        <input type="text" id="store-name-1" name="store-name" required>
                    </div>

                    <div class="form-group">
                        <label for="product-image">商品图片上传：</label>
                        <input type="file" id="product-image-1" name="product-image" accept="image/*" onchange="previewImage(event, 1)">
                        <img id="image-preview-1" class="image-preview" src="" alt="商品图片预览">
                    </div>

                    <div class="form-group">
                        <label for="order-count">发布几单：</label>
                        <input type="number" id="order-count-1" name="order-count" min="1" max="100" required onchange="generateFields(1)">
                    </div>

                    <div class="form-group" id="keywords-group-1">
                        <label>每一单搜索的关键词：</label>
                    </div>

                    <div class="form-group" id="consultation-group-1">
                        <label>每一单需要咨询的问题：</label>
                    </div>

                    <div class="form-group" id="sku-name-group-1">
                        <label>每一单需要下单的SKU名称：</label>
                    </div>

                    <div class="form-group" id="sku-price-group-1">
                        <label>每一单SKU的单价：</label>
                    </div>

                    <div class="form-group" id="quantity-group-1">
                        <label>每一单需要拍多少件：</label>
                    </div>

                    <div class="form-group" id="payment-amount-group-1">
                        <label>每一单实际付款金额：</label>
                    </div>

                    <div class="form-group">
                        <label for="task-requirements">任务要求：</label>
                        <textarea id="task-requirements-1" name="task-requirements" rows="5" >
注意：下单全程无截图，货比三家，多看别家和我们链接评价，加入收藏或者购物车（2选1），然后再收藏或者购物车（2选1）下单付款即可！
                        </textarea>
                    </div>


                </form>
            </div>
        </div>

        <button class="add-remove-btn" onclick="addPublishArea()">增加发布区域</button>
        <button class="add-remove-btn" onclick="removePublishArea()">减少发布区域</button>

        <button type="button" class="submit-btn" onclick="submitAllForms()">发布任务</button>
    </div>

    <script>
        let areaCount = 1;
    
        function previewImage(event, areaNumber) {
            const reader = new FileReader();
            reader.onload = function() {
                const output = document.getElementById('image-preview-' + areaNumber);
                output.src = reader.result;
                // Store base64 image in a hidden input field for later use
                document.getElementById('base64-image-' + areaNumber).value = reader.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    
        function generateFields(areaNumber) {
            const orderCount = document.getElementById('order-count-' + areaNumber).value;
    
            // Reset all groups
            document.getElementById('keywords-group-' + areaNumber).innerHTML = '<label>每一单搜索的关键词：</label>';
            document.getElementById('consultation-group-' + areaNumber).innerHTML = '<label>每一单需要咨询的问题：</label>';
            document.getElementById('sku-name-group-' + areaNumber).innerHTML = '<label>每一单需要下单的SKU名称：</label>';
            document.getElementById('sku-price-group-' + areaNumber).innerHTML = '<label>每一单SKU的单价：</label>';
            document.getElementById('quantity-group-' + areaNumber).innerHTML = '<label>每一单需要拍多少件：</label>';
            document.getElementById('payment-amount-group-' + areaNumber).innerHTML = '<label>每一单实际付款金额：</label>';
			
			// 删除之前可能存在的任务时间区域
			    const existingTaskTimeGroup = document.getElementById('task-time-group-' + areaNumber);
			    if (existingTaskTimeGroup) {
			        existingTaskTimeGroup.remove();
			    }
			
			    // 添加新任务时间输入框
			    const taskTimeGroup = document.createElement('div');
			    taskTimeGroup.classList.add('form-group');
			    taskTimeGroup.id = 'task-time-group-' + areaNumber;
			    taskTimeGroup.innerHTML = '<label>每一单做任务时间：</label>';
			    document.getElementById('payment-amount-group-' + areaNumber).after(taskTimeGroup);

    
            // Generate input fields for each order
            for (let i = 1; i <= orderCount; i++) {
                document.getElementById('keywords-group-' + areaNumber).innerHTML += `
                    <label>第${i}单关键词：</label>
                    <input type="text" name="keywords[]" placeholder="第${i}单关键词" required style="margin-bottom: 15px;"><br>
                `;
                document.getElementById('consultation-group-' + areaNumber).innerHTML += `
                    <label>第${i}单咨询问题：</label>
                    <input type="text" name="consultation[]" placeholder="第${i}单咨询问题" required style="margin-bottom: 15px;"><br>
                `;
                document.getElementById('sku-name-group-' + areaNumber).innerHTML += `
                    <label>第${i}单SKU名称：</label>
                    <input type="text" name="sku-name[]" placeholder="第${i}单SKU名称" required style="margin-bottom: 15px;"><br>
                `;
                document.getElementById('sku-price-group-' + areaNumber).innerHTML += `
                    <label>第${i}单SKU单价：</label>
                    <input type="number" name="sku-price[]" placeholder="第${i}单SKU单价" min="0" step="0.01" required style="margin-bottom: 15px;"><br>
                `;
                document.getElementById('quantity-group-' + areaNumber).innerHTML += `
                    <label>第${i}单拍多少件：</label>
                    <input type="number" name="quantity[]" placeholder="第${i}单拍多少件" min="1" required style="margin-bottom: 15px;"><br>
                `;
                document.getElementById('payment-amount-group-' + areaNumber).innerHTML += `
                    <label>第${i}单实际付款金额：</label>
                    <input type="number" name="payment-amount[]" placeholder="第${i}单实际付款金额" min="0" step="0.01" required style="margin-bottom: 15px;"><br>
                `;

				// 添加新任务时间输入框
				document.getElementById('task-time-group-' + areaNumber).innerHTML += `
				    <label>第${i}单任务时间：</label>
				    <input type="text" name="task-time[]" placeholder="第${i}单任务时间" required style="margin-bottom: 15px;"><br>
				`;
            }
        }
    // 保存第一个发布区域的模板
    const firstPublishAreaTemplate = document.getElementById('publish-area-1').innerHTML;

        function addPublishArea() {
            areaCount++;
            
            const newArea = document.createElement('div');
            newArea.classList.add('publish-area');
            newArea.id = 'publish-area-' + areaCount;
            newArea.innerHTML = document.getElementById('publish-area-1').innerHTML.replace(/1/g, areaCount);
            
			// 复制第一个发布区域的模板
			    newArea.innerHTML = firstPublishAreaTemplate.replace(/1/g, areaCount);
			
            const title = document.createElement('h2');
            title.textContent = '任务' + areaCount;
            title.style.color = '#333';
            title.style.fontSize = '24px';
            title.style.textAlign = 'center';
            title.style.marginBottom = '20px';
            
            const hr = document.createElement('hr');
            hr.style.border = '3px double #5e5e5e';
            hr.style.margin = '60px 0';
            
            const container = document.getElementById('publish-areas-container');
            container.appendChild(hr);
            newArea.prepend(title);
            container.appendChild(newArea);
        }
    
        function removePublishArea() {
            if (areaCount > 1) {
                document.getElementById('publish-area-' + areaCount).remove();
                const container = document.getElementById('publish-areas-container');
                const hrElements = container.getElementsByTagName('hr');
                if (hrElements.length > 0) {
                    container.removeChild(hrElements[hrElements.length - 1]);
                }
                areaCount--;
            }
        }
    
        function submitAllForms() {
            let content = '';
            let promises = [];  // 用来保存所有图片转换为Base64的Promise
            let fileName = '';
			
			// 在最上方加上“本页一共发布了几个任务”字样
			    content += `
			        <div style="text-align: center; font-size: 30px; font-weight: bold; color: #652fff; margin-bottom: 20px;">
			            本页一共发布了 ${areaCount} 个任务，请往下翻
			        </div>
			    `;
        
            for (let i = 1; i <= areaCount; i++) {
                const formData = new FormData(document.getElementById('task-form-' + i));
                
                // 获取店铺名称和发布日期，用于生成文件名
                const storeName = formData.get('store-name');
                const releaseDate = formData.get('release-date');
                if (i === 1) {
                    // 第一个区域的店铺名称和发布日期用于文件命名
                    fileName = `${storeName}_${releaseDate}.html`;
                }
                
                // 获取图片文件
                const productImageFile = document.getElementById('product-image-' + i).files[0];
                let base64Image = '';
                
                // 如果有图片，加入Base64转换过程
                if (productImageFile) {
                    let promise = getBase64Image(productImageFile).then(base64 => {
                        base64Image = base64;  // 图片转换完成，保存Base64数据
                    });
                    promises.push(promise);  // 把Promise加入等待队列
                }
        
                // 等待所有图片转换完成后再生成HTML内容
                promises.push(new Promise(resolve => {
                    Promise.all(promises).then(() => {
                        content += `
                            <html>
                                <head>
                                    <style>
                                        body {
                                            font-family: Arial, sans-serif;
                                            font-size: 14px;
                                            color: #333;
                                        }
                                        table {
                                            width: 100%;
                                            border-collapse: collapse;
                                        }
                                        th, td {
                                            padding: 10px;
                                            border: 1px solid #ccc;
                                            text-align: left;
                                        }
                                        h1 {
											color:#8063ff;
										}
										h2 {
											color:#656565;
										}
										span {
											color:#8063ff;
										}
                                    </style>
                                </head>
                                <body>
                                    <h1><span>-------任务分割线-------（分割线以下是任务 ${i}）</span></h1>
                                    <table>
                                        <tr><th>发布日期</th><td>${formData.get('release-date')}</td></tr>
                                        <tr><th>店铺名称</th><td>${formData.get('store-name')}</td></tr>
                                        <tr><th>商品图片</th><td><img src="${base64Image}" style="max-width: 300px; max-height: 300px;"></td></tr>
                                        <tr><th>发布几单</th><td>${formData.get('order-count')}</td></tr>
                                        <tr><th>任务要求</th><td>${formData.get('task-requirements')}</td></tr>
                                    </table>
                                    <h2>每一单信息</h2>
                                    <table>
                                        <thead>
                                            <tr><th>单号</th><th>关键词</th><th>咨询问题</th><th>SKU名称</th><th>单价</th><th>数量</th><th>实际付款金额</th><th>任务安排时间</th></tr>
                                        </thead>
                                        <tbody>
                        `;
                        
                        const orderCount = formData.get('order-count');
                        for (let j = 1; j <= orderCount; j++) {
                            content += `
                                <tr>
                                    <td>第${j}单</td>
                                    <td>${formData.getAll('keywords[]')[j - 1]}</td>
                                    <td>${formData.getAll('consultation[]')[j - 1]}</td>
                                    <td>${formData.getAll('sku-name[]')[j - 1]}</td>
                                    <td>${formData.getAll('sku-price[]')[j - 1]}</td>
                                    <td>${formData.getAll('quantity[]')[j - 1]}</td>
                                    <td>${formData.getAll('payment-amount[]')[j - 1]}</td>
									<td>${formData.getAll('task-time[]')[j - 1]}</td> <!-- 添加任务时间 -->
                                </tr>
                            `;
                        }
        
                        content += `
                            </tbody>
                            </table>
                        </body>
                            </html>
                        `;
                        resolve();  // 图片处理完成，继续生成HTML
                    });
                }));
            }
        
            // 生成文件并下载
            Promise.all(promises).then(() => {
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;  // 使用店铺名和日期作为文件名
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        
        // Helper function to convert image to Base64 string
        function getBase64Image(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = function() {
                    resolve(reader.result);  // 返回Base64数据
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);  // 转换文件为Base64
            });
        }

    </script>


</body>
</html>
